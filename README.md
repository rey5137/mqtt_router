# mqtt_router
A simple router that can route your messages between multi MQTT brokers. IT can run either as standalone app or a Windows Service.

# How to build
- Run shadowJar gradle task to build standalone java app.
- Run createWindowsService gradle task to build window service package. (You should copy the shadow jar and overwrite the jar generated in /libs folder as it isn't a fat-jar)

# How to run
- As standalone app, you can run it with the command:

```
java -jar <jar file> -p <router.properties file> -l <logback.xml file>
```
router.properties contains all config of the router.

- To run as Windows Service, go to the folder mqtt_router that is generated by createWindowsService task. 
Run mqtt_router-install.bat to install service. Copy router.properties & logback.xml files to /libs folder and run mqtt_routerw.exe to start service.

# How to config router
You can config many routes. Configs for 1 route has to be prefixed with **route[${index}]**

- **router[${index}].in.host**: MQTT host for in (subscriber) connection.
- **router[${index}].in.client_id**: Client Id for in connection. If not set, the service will generate a UUID for client_id.
- **router[${index}].in.automatic_reconnect**: automatic reconnect for in connection. Default is false
- **router[${index}].in.username**: Optional username for in connection
- **router[${index}].in.password**: Optional password for in connection
- **router[${index}].in.topic**: The topic that in connection will subscribe to.
- **router[${index}].in.qos**: The QOS of subscription.
- **router[${index}].in.persistence.type**: The persistence type for in-flight message. There are 2 types: memory & file
- **router[${index}].in.persistence.directory**: The directory to store message if you use persistence.type = memory
- **router[${index}].out.host**: MQTT host for out (publisher) connection.
- **router[${index}].out.client_id**: Client Id for out connection
- **router[${index}].out.automatic_reconnect**: automatic reconnect for out connection. Default is false
- **router[${index}].out.username**: Optional username for out connection
- **router[${index}].out.password**: Optional password for out connection
- **router[${index}].out.number_of_connections**: Number of out connections. Default is 1.
- **router[${index}].out.persistence.type**:  The persistence type for in-flight message
- **router[${index}].name**: Optional name for route.
- **router[${index}].topic-mapper.type**: The type of topic mapper. Topic mapper will map the topic of incoming messages to another topic for outgoing messages. Currently has 3 types: **default** - keep same topic, **prepend** - prepend predefined value to outgoing topic, **append** - append predefined value to outgoing topic
- **router[${index}].topic-mapper.value**: The predefined value if you use topic-mapper.type = **prepend** or **append**
- **router[${index}].topic-filter.type**: The type of topic filter. Topic mapper will filter messages by topic name before passing it to topic mapper. Currently has 3 types: **default** - accept all, **whitelist** - accept only topics in the whitelist, **blacklist** - accept all topics outside the blacklist
- **router[${index}].topic-filter.value**: The list of topic, separated by ; if you use topic-filter.type = **whitelist** or **blacklist**